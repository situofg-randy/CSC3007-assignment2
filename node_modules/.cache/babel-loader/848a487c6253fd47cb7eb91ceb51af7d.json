{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import{select,scaleBand,axisBottom,stack,max,scaleLinear,axisLeft,stackOrderAscending,pointer}from\"d3\";import useResizeObserver from\"./useResizeObserver\";/**\n * Component that renders a StackedBarChart\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function StackedBarChart(_ref){var data=_ref.data,keys=_ref.keys,colors=_ref.colors;var svgRef=useRef();var wrapperRef=useRef();var dimensions=useResizeObserver(wrapperRef);var tooltip=select(\"#tooltip\").append(\"div\").style(\"opacity\",0).attr(\"class\",\"tooltip\").style(\"background-color\",\"white\").style(\"border\",\"solid\").style(\"border-width\",\"1px\").style(\"border-radius\",\"5px\").style(\"padding\",\"10px\");var mouseover=function mouseover(d){var subgroupName=select(this.parentNode).datum().key;tooltip.html(\"subgroup: \"+subgroupName).style(\"opacity\",1);};var mousemove=function mousemove(d){tooltip.style(\"left\",pointer(this)[0]+90+\"px\")// It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect\n.style(\"top\",pointer(this)[1]+\"px\");};var mouseleave=function mouseleave(d){tooltip.style(\"opacity\",0);};// will be called initially and on every data change\nuseEffect(function(){var svg=select(svgRef.current);var _ref2=dimensions||wrapperRef.current.getBoundingClientRect(),width=_ref2.width,height=_ref2.height;// stacks / layers\nvar stackGenerator=stack().keys(keys).order(stackOrderAscending);var layers=stackGenerator(data);console.log(layers);var extent=[0,max(layers,function(layer){return max(layer,function(sequence){return sequence[1];});})];// scales\nvar xScale=scaleBand().domain(data.map(function(d){return d.year;})).range([0,width]).padding(0.25);var yScale=scaleLinear().domain(extent).range([height,0]);// rendering\nsvg.selectAll(\".layer\").data(layers).join(\"g\").attr(\"class\",\"layer\").attr(\"fill\",function(layer){return colors[layer.key];}).selectAll(\"rect\").data(function(layer){return layer;}).join(\"rect\").attr(\"x\",function(sequence){return xScale(sequence.data.year);}).attr(\"width\",xScale.bandwidth()).attr(\"y\",function(sequence){return yScale(sequence[1]);}).attr(\"height\",function(sequence){return yScale(sequence[0])-yScale(sequence[1]);}).on(\"mouseover\",function(event,d){select(\".tooltip\").text(\"Year: \"+d.data.year).style(\"position\",\"absolute\").style(\"background\",\"#fff\").style(\"left\",event.pageX+\"px\").style(\"top\",event.pageY+\"px\");select(event.currentTarget).classed(\"selected\",true);}).on(\"mouseout\",function(event,d){select(\".tooltip\").text(\"\");select(event.currentTarget).classed(\"selected\",false);});// axes\nvar xAxis=axisBottom(xScale);svg.select(\".x-axis\").attr(\"transform\",\"translate(0, \".concat(height,\")\")).call(xAxis);var yAxis=axisLeft(yScale);svg.select(\".y-axis\").call(yAxis);},[colors,data,dimensions,keys]);return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{class:\"tooltip\"}),/*#__PURE__*/_jsx(\"div\",{ref:wrapperRef,style:{marginBottom:\"2rem\"},children:/*#__PURE__*/_jsxs(\"svg\",{ref:svgRef,children:[/*#__PURE__*/_jsx(\"g\",{className:\"x-axis\"}),/*#__PURE__*/_jsx(\"g\",{className:\"y-axis\"})]})})]});}export default StackedBarChart;","map":{"version":3,"names":["React","useEffect","useRef","select","scaleBand","axisBottom","stack","max","scaleLinear","axisLeft","stackOrderAscending","pointer","useResizeObserver","StackedBarChart","data","keys","colors","svgRef","wrapperRef","dimensions","tooltip","append","style","attr","mouseover","d","subgroupName","parentNode","datum","key","html","mousemove","mouseleave","svg","current","getBoundingClientRect","width","height","stackGenerator","order","layers","console","log","extent","layer","sequence","xScale","domain","map","year","range","padding","yScale","selectAll","join","bandwidth","on","event","text","pageX","pageY","currentTarget","classed","xAxis","call","yAxis","marginBottom"],"sources":["/Users/angrandy/Desktop/CSC3007-assignment2/src/StackedBarChart.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport {\n  select,\n  scaleBand,\n  axisBottom,\n  stack,\n  max,\n  scaleLinear,\n  axisLeft,\n  stackOrderAscending,\n  pointer\n} from \"d3\";\nimport useResizeObserver from \"./useResizeObserver\";\n\n/**\n * Component that renders a StackedBarChart\n */\n\nfunction StackedBarChart({ data, keys, colors }) {\n  const svgRef = useRef();\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n\n  var tooltip = select(\"#tooltip\")\n    .append(\"div\")\n    .style(\"opacity\", 0)\n    .attr(\"class\", \"tooltip\")\n    .style(\"background-color\", \"white\")\n    .style(\"border\", \"solid\")\n    .style(\"border-width\", \"1px\")\n    .style(\"border-radius\", \"5px\")\n    .style(\"padding\", \"10px\")\n\n  var mouseover = function(d) {\n    var subgroupName = select(this.parentNode).datum().key;\n    \n    tooltip\n        .html(\"subgroup: \" + subgroupName)\n        .style(\"opacity\", 1)\n  }\n\n  var mousemove = function(d) {\n    tooltip\n      .style(\"left\", (pointer(this)[0]+90) + \"px\") // It is important to put the +90: other wise the tooltip is exactly where the point is an it creates a weird effect\n      .style(\"top\", (pointer(this)[1]) + \"px\")\n  }\n  var mouseleave = function(d) {\n    tooltip\n      .style(\"opacity\", 0)\n  }\n\n  // will be called initially and on every data change\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const { width, height } =\n      dimensions || wrapperRef.current.getBoundingClientRect();\n\n    // stacks / layers\n    const stackGenerator = stack()\n      .keys(keys)\n      .order(stackOrderAscending);\n    const layers = stackGenerator(data);\n    console.log(layers)\n\n    const extent = [\n      0,\n      max(layers, layer => max(layer, sequence => sequence[1]))\n    ];\n\n    // scales\n    const xScale = scaleBand()\n      .domain(data.map(d => d.year))\n      .range([0, width])\n      .padding(0.25);\n\n    const yScale = scaleLinear()\n      .domain(extent)\n      .range([height, 0]);\n\n    // rendering\n    svg\n      .selectAll(\".layer\")\n      .data(layers)\n      .join(\"g\")\n      .attr(\"class\", \"layer\")\n      .attr(\"fill\", layer => colors[layer.key])\n      .selectAll(\"rect\")\n      .data(layer => layer)\n      .join(\"rect\")\n      .attr(\"x\", sequence => xScale(sequence.data.year))\n      .attr(\"width\", xScale.bandwidth())\n      .attr(\"y\", sequence => yScale(sequence[1]))\n      .attr(\"height\", sequence => yScale(sequence[0]) - yScale(sequence[1]))\n      .on(\"mouseover\", (event, d) => {\n        select(\".tooltip\")\n        .text(\"Year: \" + d.data.year)\n        .style(\"position\", \"absolute\")\n        .style(\"background\", \"#fff\")\n        .style(\"left\", (event.pageX) + \"px\")\n        .style(\"top\", (event.pageY) + \"px\");\n\n        select(event.currentTarget).classed(\"selected\", true)\n    })\n    .on(\"mouseout\", (event, d) => {\n      select(\".tooltip\")\n      .text(\"\");\n\n      select(event.currentTarget).classed(\"selected\", false)\n  })\n\n    // axes\n    const xAxis = axisBottom(xScale);\n    svg\n      .select(\".x-axis\")\n      .attr(\"transform\", `translate(0, ${height})`)\n      .call(xAxis);\n\n    const yAxis = axisLeft(yScale);\n    svg.select(\".y-axis\").call(yAxis);\n  }, [colors, data, dimensions, keys]);\n\n  return (\n    <React.Fragment>\n      <div class=\"tooltip\"></div>\n      <div ref={wrapperRef} style={{ marginBottom: \"2rem\" }}>\n        <svg ref={svgRef}>\n          <g className=\"x-axis\" />\n          <g className=\"y-axis\" />\n        </svg>\n      </div>\n    </React.Fragment>\n  );\n}\n\nexport default StackedBarChart;"],"mappings":"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"},"metadata":{},"sourceType":"module"}