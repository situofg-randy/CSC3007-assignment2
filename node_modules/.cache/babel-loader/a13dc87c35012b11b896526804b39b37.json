{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import{select,scaleBand,axisBottom,stack,max,scaleLinear,axisLeft,stackOrderAscending}from\"d3\";import useResizeObserver from\"./useResizeObserver\";/**\n * Component that renders a StackedBarChart\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function StackedBarChart(_ref){var data=_ref.data,keys=_ref.keys,colors=_ref.colors;var svgRef=useRef();var wrapperRef=useRef();var dimensions=useResizeObserver(wrapperRef);// will be called initially and on every data change\nuseEffect(function(){var svg=select(svgRef.current);var _ref2=dimensions||wrapperRef.current.getBoundingClientRect(),width=_ref2.width,height=_ref2.height;// stacks / layers\nvar stackGenerator=stack().keys(keys).order(stackOrderAscending);var layers=stackGenerator(data);console.log(layers);var extent=[0,max(layers,function(layer){return max(layer,function(sequence){return sequence[1];});})];// scales\nvar xScale=scaleBand().domain(data.map(function(d){return d.year;})).range([0,width]).padding(0.25);var yScale=scaleLinear().domain(extent).range([height,0]);// rendering\nsvg.selectAll(\".layer\").data(layers).join(\"g\").attr(\"class\",\"layer\").attr(\"fill\",function(layer){return colors[layer.key];}).selectAll(\"rect\").data(function(layer){return layer;}).join(\"rect\").attr(\"x\",function(sequence){return xScale(sequence.data.year);}).attr(\"width\",xScale.bandwidth()).attr(\"y\",function(sequence){return yScale(sequence[1]);}).attr(\"height\",function(sequence){return yScale(sequence[0])-yScale(sequence[1]);});// axes\nvar xAxis=axisBottom(xScale);svg.select(\".x-axis\").attr(\"transform\",\"translate(0, \".concat(height,\")\")).call(xAxis);var yAxis=axisLeft(yScale);svg.select(\".y-axis\").call(yAxis);},[colors,data,dimensions,keys]);return/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(\"div\",{ref:wrapperRef,style:{marginBottom:\"2rem\"},children:/*#__PURE__*/_jsxs(\"svg\",{ref:svgRef,children:[/*#__PURE__*/_jsx(\"g\",{className:\"x-axis\"}),/*#__PURE__*/_jsx(\"g\",{className:\"y-axis\"})]})})});}export default StackedBarChart;","map":{"version":3,"names":["React","useEffect","useRef","select","scaleBand","axisBottom","stack","max","scaleLinear","axisLeft","stackOrderAscending","useResizeObserver","StackedBarChart","data","keys","colors","svgRef","wrapperRef","dimensions","svg","current","getBoundingClientRect","width","height","stackGenerator","order","layers","console","log","extent","layer","sequence","xScale","domain","map","d","year","range","padding","yScale","selectAll","join","attr","key","bandwidth","xAxis","call","yAxis","marginBottom"],"sources":["/Users/angrandy/Desktop/CSC3007-assignment2/src/StackedBarChart.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport {\n  select,\n  scaleBand,\n  axisBottom,\n  stack,\n  max,\n  scaleLinear,\n  axisLeft,\n  stackOrderAscending\n} from \"d3\";\nimport useResizeObserver from \"./useResizeObserver\";\n\n/**\n * Component that renders a StackedBarChart\n */\n\nfunction StackedBarChart({ data, keys, colors }) {\n  const svgRef = useRef();\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n\n  // will be called initially and on every data change\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const { width, height } =\n      dimensions || wrapperRef.current.getBoundingClientRect();\n\n    // stacks / layers\n    const stackGenerator = stack()\n      .keys(keys)\n      .order(stackOrderAscending);\n    const layers = stackGenerator(data);\n    console.log(layers)\n\n    const extent = [\n      0,\n      max(layers, layer => max(layer, sequence => sequence[1]))\n    ];\n\n    // scales\n    const xScale = scaleBand()\n      .domain(data.map(d => d.year))\n      .range([0, width])\n      .padding(0.25);\n\n    const yScale = scaleLinear()\n      .domain(extent)\n      .range([height, 0]);\n\n    // rendering\n    svg\n      .selectAll(\".layer\")\n      .data(layers)\n      .join(\"g\")\n      .attr(\"class\", \"layer\")\n      .attr(\"fill\", layer => colors[layer.key])\n      .selectAll(\"rect\")\n      .data(layer => layer)\n      .join(\"rect\")\n      .attr(\"x\", sequence => xScale(sequence.data.year))\n      .attr(\"width\", xScale.bandwidth())\n      .attr(\"y\", sequence => yScale(sequence[1]))\n      .attr(\"height\", sequence => yScale(sequence[0]) - yScale(sequence[1]));\n\n    // axes\n    const xAxis = axisBottom(xScale);\n    svg\n      .select(\".x-axis\")\n      .attr(\"transform\", `translate(0, ${height})`)\n      .call(xAxis);\n\n    const yAxis = axisLeft(yScale);\n    svg.select(\".y-axis\").call(yAxis);\n  }, [colors, data, dimensions, keys]);\n\n  return (\n    <React.Fragment>\n      <div ref={wrapperRef} style={{ marginBottom: \"2rem\" }}>\n        <svg ref={svgRef}>\n          <g className=\"x-axis\" />\n          <g className=\"y-axis\" />\n        </svg>\n      </div>\n    </React.Fragment>\n  );\n}\n\nexport default StackedBarChart;"],"mappings":"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"},"metadata":{},"sourceType":"module"}